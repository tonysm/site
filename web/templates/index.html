{{define "title"}}
Candidatos.info - {{index . "title"}}
{{end}}

{{define "app-select-field"}}
<div>
    <template x-if="{{.}}.config.label">
        <label
            class="block text-sm font-bold mb-2"
            :id="{{.}}.config.id"
            x-text="{{.}}.config.label"
        ></label>
    </template>
    <div class="inline-block w-full relative">
        <select
            class="block appearance-none w-full bg-white text-disabled-button border border-border-button hover:border-gray-500 p-3 pr-8 rounded shadow leading-tight focus:outline-none focus:shadow-outline"
            x-model="{{.}}.value"
        >
            <template x-if="{{.}}.config.placeholder">
                <option value="" x-text="{{.}}.config.placeholder"></option>
            </template>

            <template
                x-for="option in {{.}}.config.options"
                :key="option.value || option"
            >
                <option
                    :value="option.value || option"
                    x-text="`${option.label || option}`"
                ></option>
            </template>
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
            </svg>
        </div>
    </div>
</div>
{{end}}

{{define "app-text-field"}}
<div>
    <template x-if="{{.}}.config.label">
        <label
            class="block text-sm font-bold mb-2"
            :id="{{.}}.config.id"
            x-text="{{.}}.config.label"
        ></label>
    </template>
    <input
        class="shadow appearance-none border border-border-button text-center rounded w-full p-3 text-disabled-button leading-tight focus:outline-none focus:shadow-outline"
        :type="{{.}}.config.type"
        x-model="{{.}}.value"
    />
</div>
{{end}}

{{define "app-tags-field"}}
<div
   @tags-close.window="{{.}}.config.isOpen = false"
>
    <div class="-mx-3 mb-2 relative overflow-visible">
        <div class="w-full px-3 md:mb-0 ">
            <template x-if="{{.}}.config.label">
                <label
                    class="block text-disabled-button text-sm font-bold mb-2"
                    :id="{{.}}.config.id"
                    x-text="{{.}}.config.label"
                ></label>
            </template>
            <div class="w-full relative">
                <button
                    @click.prevent="{{.}}.config.isOpen = !{{.}}.config.isOpen"
                    class="shadow w-full p-2 pl-4 leading-6 rounded bg-white text-disabled-button border border-border-button hover:border-gray-500"
                    x-text="{{.}}.config.placeholder"
                ></button>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                    </svg>
                </div>
            </div>

            <template x-if="{{.}}.config.isOpen">
                <div class="absolute px-3 left-0 w-full flex flex-col divide-y-2 divide-gray-100 bg-red">
                    <div class="shadow divide-y-2">
                        <template
                            x-for="option in {{.}}.remainingOptions"
                            :key="option"
                        >
                            <button
                                class="w-full p-2 bg-white"
                                @click.prevent="{{.}}.addTag(option)"
                                x-text="option"
                            ></button>
                        </template>
                        <template x-if="{{.}}.remainingOptions.length === 0">
                            <div
                                class="w-full text-center text-xs px-2 py-4 bg-white"
                                x-text="{{.}}.config.emptyOptionsText"
                            ></div>
                        </template>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <p class="text-disabled-button text-sm" x-show="{{.}}.tagsLimitReached">
        você atingiu o limite máximo de pautas.
    </p>

    <div class="flex flex-wrap -mx-1">
        <template x-for="selected in {{.}}.value" :key="selected">
            <div class="w-2/5 p-1">
                <div class="text-center bg-border-button text-white px-2 py-0 rounded-full flex items-center justify-between">
                    <span class="truncate flex-1 text-center" x-text="selected"></span>
                    <button @click.prevent="{{.}}.remove(selected)">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                             xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </template>
    </div>
</div>
{{end}}

{{define "app-candidates-filter"}}
<div>
    <div class="border-b mb-4 pb-4">
        <div class="p-4 pb-0 flex flex-wrap">
            <div class="w-2/3 md:mb-0">
                {{template "app-select-field" "filters.state"}}
            </div>
            <div class="w-1/3 pl-3">
                {{template "app-text-field" "filters.year"}}
            </div>
        </div>
    </div>

    <template x-if="filters.state.value" :key="'cityAndPosition'">
        <div class="px-4 mb-4 flex flex-wrap">
            <div class="w-2/3 md:mb-0">
                {{template "app-select-field" "filters.city"}}
            </div>
            <div class="w-1/3 pl-3">
                {{template "app-select-field" "filters.position"}}
            </div>
        </div>
    </template>

    <div class="px-4 pb-2 pb-2">
        {{template "app-tags-field" "filters.tags"}}
    </div>
</div>
{{end}}

{{define "body"}}
<div
    class="font-sans leading-loose overflow-hidden"
    x-data="{
        filters: {
            state: {
                value: '',
                config: {
                    options: ['Alagoas', 'Bahia']
                }
            },
            year: {
                value: (new Date).getFullYear(),
                config: {
                    type: 'year',
                }
            },
            city: {
                value: '',
                config: {
                    id: 'city',
                    placeholder: 'Cidade',
                    options: ['Maceió', 'Arapiraca'],
                }
            },
            position: {
                value: '',
                config: {
                    id: 'position',
                    placeholder: 'Cargo',
                    options: [
                        { label: 'Vereador', value: 'vereador' },
                        { label: 'Prefeito', value: 'prefeito' },
                    ],
                }
            },
            tags: {
                value: [],
                get remainingOptions() {
                    return this.config.options.filter(opt => ! this.value.includes(opt))
                },
                get tagsLimitReached() {
                    return this.config.max &&  this.value.length >= this.max;
                },
                remove(item) {
                     this.value =  this.value.filter(opt => opt !== item);
                },
                addTag(tag) {
                    // Prevent adding more tags than the limit.
                    if (this.tagsLimitReached) {
                        $dispatch('tags-close');
                        return false;
                    }

                    this.value.push(tag);
                },
                config: {
                    isOpen: false,
                    id: 'tags',
                    placeholder: 'Pautas',
                    options: ['Urbanismo', 'Veganismo', 'Ciclismo'],
                    max: 2,
                    emptyOptionsText: 'Todos as pautas foram selecionadas.',
                }
            }
        }
    }"
>
    <!-- Filters -->
    <section class="w-full sm:max-w-4xl mx-auto border-b text-sm sm:text-lg text-text">
        {{template "app-candidates-filter" .}}
    </section>
    <!-- End of Filters -->

<!--    <section class="mt-4 px-4 max-w-4xl mx-auto grid gap-2 grid-cols-2 sm:grid-cols-3 md:grid-cols-4">-->
<!--        <a :href="`/candidatos/${candidate.id}`" v-for="candidate in candidates" :key="candidate.id">-->
<!--            <app-candidate-card :candidate="candidate" />-->
<!--        </a>-->
<!--    </section>-->
<!--    <div class="text-center text-sm text-text">-->
<!--        <button @click.prevent="loadMore" class="inline-flex items-center space-x-2 p-2">-->
<!--            <svg v-if="loadingMore" class="animate-spin mr-2 -ml-1 h-5 w-5 text-text" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">-->
<!--                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>-->
<!--                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>-->
<!--            </svg>-->
<!--            ver mais-->
<!--        </button>-->
<!--    </div>-->
</div>
{{end}}